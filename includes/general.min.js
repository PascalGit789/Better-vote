function form_add_input(){if($(".form_option").last().val()>""){var e=+$(".form_option").last().attr("id").split("_")[2]+1;if(e>10)return 0;$(".form_p_option").append("<input type='text' id='form_option_"+e+"' class='form_option' placeholder='"+e+"..' maxlength='75' onKeyUp='form_add_input()'>")}}function show_pie_legend(e,t){for(var a=0,o=null,r=0;r<e.data.datasets[0].data.length;r++)a<(n=e.data.datasets[0].data[r])&&(a=n,o=r);for(r=0;r<e.data.datasets[0].data.length;r++)a==(n=e.data.datasets[0].data[r])&&o!=r&&(o=null);var l="";l+="<table class='pie_legend_table table_border'>",l+="<tr style='font-size:1.05rem;'>",l+="<th style='border: 3px solid #898989; border-bottom: 0;'>Candidate</th><th style='border: 3px solid #898989; border-bottom: 0;'>Score</th>",l+="</tr>";for(r=0;r<e.data.datasets[0].data.length;r++){var n=e.data.datasets[0].data[r];0!=n||"AV"!=t&&"supplementary"!=t||(n="-"),l+=o==r?"<tr class='table_option_winner'>":"<tr style=''>",l+="<td style='border:3px solid "+e.data.datasets[0].backgroundColor[r]+";'>",e.data.labels[r]&&(l+=e.data.labels[r]),l+="</td>",l+="<td style='border:3px solid "+e.data.datasets[0].backgroundColor[r]+";' class='pie_legend_score_span_"+t+"'>"+n+"</td>",l+="</tr>"}return l+="</table>"}function refresh_chart(){var e=window.location.href.split("/").pop();$.ajax({type:"POST",cache:!1,url:"jx.php?action=refresh_result",data:"url_poll="+e,complete:function(e,t){var a=e.responseText.trim();if(0==a)return!1;a=$.parseJSON(a),$.each(a,function(e,t){if("condorcet"==e)$("#div_condorcet_result").html(t);else if("all_around_winnner"==e)$("#div_all_around_winner_result").html(t);else{var a=0;$.each(t,function(t,o){"all_vote"==e?$.each(o,function(e,t){var o=e-1;void 0!==chart_all_votes.data.datasets[o]&&(chart_all_votes.data.datasets[o].data[a]=t)}):"FPTP"==e?(chart_FPTP.data.datasets[0].data[a]=o,$(".pie_legend_score_span_FPTP:eq("+a+")").html(o)):"AV"==e?(chart_AV.data.datasets[0].data[a]=o,+o>0?$(".pie_legend_score_span_AV:eq("+a+")").html(o):$(".pie_legend_score_span_AV:eq("+a+")").html("-")):"approval"==e?(chart_approval.data.datasets[0].data[a]=o,$(".pie_legend_score_span_approval:eq("+a+")").html(o)):"borda"==e?(chart_borda.data.datasets[0].data[a]=o,$(".pie_legend_score_span_borda:eq("+a+")").html(o)):"supplementary"==e&&(chart_supplementary.data.datasets[0].data[a]=o,+o>0?$(".pie_legend_score_span_supplementary:eq("+a+")").html(o):$(".pie_legend_score_span_supplementary:eq("+a+")").html("-")),a++})}}),$(".pop_up_refresh").fadeIn(),setTimeout(function(){$(".pop_up_refresh").fadeOut()},1200),console.log("updated"),chart_all_votes.update(),chart_FPTP.update(),chart_AV.update(),chart_approval.update(),chart_borda.update(),chart_supplementary.update(),$(".pie_legend_table .table_option_winner").removeClass();var o=a.winner_score.FPTP;null!=o&&(o++,$("#FPTP_pie tr:eq("+o+")").addClass("table_option_winner"));var r=a.winner_score.AV;null!=r&&(r++,$("#AV_pie tr:eq("+r+")").addClass("table_option_winner"));var l=a.winner_score.approval;null!=l&&(l++,$("#approval_pie tr:eq("+l+")").addClass("table_option_winner"));var n=a.winner_score.borda;null!=n&&(n++,$("#borda_pie tr:eq("+n+")").addClass("table_option_winner"));var s=a.winner_score.supplementary;null!=s&&(s++,$("#supplementary_pie tr:eq("+s+")").addClass("table_option_winner"))}})}function isScrolledIntoView(e){var t=$(window).scrollTop(),a=t+$(window).height(),o=$(e).offset().top;return o+$(e).height()<=a&&o>=t}function scrollToAnchor(e){var t=$("div[id='"+e+"']");$("html,body").animate({scrollTop:t.offset().top},"slow")}if($(".form_vote_checkbox").change(function(){if(1==$(this).prop("checked")){var e=0;$(".form_vote_div_order").each(function(t){e<$(this).html()&&(e=$(this).html())}),e++,$(this).prev(".form_vote_div_order").html(e)}else{var t=$(this).prev(".form_vote_div_order").html();$(this).prev(".form_vote_div_order").html(""),$(".form_vote_div_order").each(function(e){if($(this).html()>t){var a=$(this).html();a--,$(this).html(a)}})}}),$(".form_vote input[type='checkbox']").each(function(e){1!=$(this).prop("checked")||$.trim($(this).prev(".form_vote_div_order").html()).length||$(this).prop("checked",!1)}),$("#form_create_btn_create").click(function(){if(!$.trim($("#form_question").val()).length)return alert("Type a question!"),!1;var e={},t=0;if($(".form_option").each(function(a){$(this).val()>""&&(e[a]=$(this).val(),t++)}),t<2)return alert("2 options are required"),!1;if($("#form_checkbox_public").prop("checked"))var a=1;else a=0;if($("#form_checkbox_IP").prop("checked"))var o=1;else o=0;$.ajax({type:"POST",cache:!1,url:"jx.php?action=create_poll",data:"question="+$("#form_question").val()+"&options="+JSON.stringify(e)+"&public="+a+"&is_restricted_ip="+o,complete:function(e,t){var a=e.responseText.trim();0!=a&&2!=a&&8==a.length?window.location="/Better_vote/v/"+a:2==a?alert("You have reach the maximum number of poll created for your IP. Email me if you want me to reset it (bettervote1@gmail.com). I'll do it if I see that you are not a bot."):alert("You need to enter a question and 2 polls options")}})}),$("#form_vote_btn_vote").click(function(){var e=$(".form_vote").attr("id").split("_")[2],t={};$(".form_vote_div_order").each(function(e){$(this).html()>""&&(t[$(this).html()]=$(this).attr("id").split("_")[3])}),$.ajax({type:"POST",cache:!1,url:"jx.php?action=vote",data:"id_poll="+e+"&vote_order="+JSON.stringify(t),complete:function(e,t){var a=e.responseText.trim();if(1==a){var o=window.location.href.split("/").pop();window.location="/Better_vote/r/"+o}else 2==a&&alert("This poll is restricted to one vote per IP. You already voted!")}})}),$("#form_search_btn").click(function(){$.ajax({type:"POST",cache:!1,url:"jx.php?action=search",data:"search_text="+$("#form_search_text").val(),complete:function(e,t){var a=e.responseText.trim();if(0==a)return!1;$(".div_main_border_search").length?($(".div_main_border_search").remove(),$("form.form_search").after(a)):($(".div_column_bottom ").remove(),$("form.form_search").removeClass("col-md-offset-0").addClass("col-md-offset-17-5-pourcent"),$("form.form_search").after(a))}})}),$(".result_header_div").click(function(){$(this).find(".result_header_detail").toggle()}),$(".form_btn_share").click(function(){alert("Share is not implemented yet.. You can just copy and paste the URL where you want.")}),$("#FPTP_pie").length){if("750"==$(".container").width())var chart_bar_font_size=17,chart_pie_font_size=19;else var chart_bar_font_size=13,chart_pie_font_size=15;var all_vote_label=[],all_vote_result1=[],all_vote_result2=[],all_vote_result3=[],nbr_options=$(".all_vote_each").length;$(".all_vote_each").each(function(e){var t=$(this).find(".all_vote_texte").html(),a=80/nbr_options;t.length>a&&(t=t.substring(0,a-4)+" ..."),all_vote_label.push(t),all_vote_result1.push($(this).find(".all_vote_result_1").html()),all_vote_result2.push($(this).find(".all_vote_result_2").html()),all_vote_result3.push($(this).find(".all_vote_result_3").html())}),$(".all_vote_result").remove();var ctxPTD=$("#chart_all_vote").get(0).getContext("2d"),chart_all_votes=new Chart(ctxPTD,{type:"bar",data:{labels:all_vote_label,datasets:[{label:"First",backgroundColor:"rgba(99, 255, 172,0.9)",data:all_vote_result1},{label:"Second",backgroundColor:"rgba(248, 243, 47, 0.9)",data:all_vote_result2},{label:"Third",backgroundColor:"rgba(255,99,132,0.9)",data:all_vote_result3}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0,userCallback:function(e,t,a){if(Math.floor(e)===e)return e},fontSize:chart_bar_font_size}}],xAxes:[{ticks:{fontSize:chart_bar_font_size}}]},responsive:!0}}),array_backgroundColor=["#5093ce","#43404c","#fab657","#871887","#56fefe","#8d8d19","#808080","#eaaede","#800000","#008000"],array_hoverBackgroundColor=["#78acd9","#605c6a","#fbcb88","#973397","#78ffff","#97972e","#b4afaf","#ebbce2","#9d2c2c","#18b818"],FPTP_label=[],FPTP_result=[];$(".FPTP_result_option").each(function(e){FPTP_label.push($(this).html()),FPTP_result.push(+$(this).next().html())}),$(".FPTP_result").remove();var config={type:"pie",data:{labels:FPTP_label,datasets:[{data:FPTP_result,backgroundColor:array_backgroundColor,hoverBackgroundColor:array_hoverBackgroundColor}]},options:{tooltips:{enabled:!0},legend:{display:!1},legendCallback:function(e){return show_pie_legend(e,"FPTP")},pieceLabel:{mode:"percentage",precision:2,fontSize:chart_pie_font_size}}},ctx=$("#chart_FPTP").get(0).getContext("2d");chart_FPTP=new Chart(ctx,config),$("#FPTP_pie").html(chart_FPTP.generateLegend());var AV_label=[],AV_result=[];$(".AV_result_option").each(function(e){AV_label.push($(this).html()),AV_result.push(+$(this).next().html())}),$(".AV_result").remove();var config={type:"pie",data:{labels:AV_label,datasets:[{data:AV_result,backgroundColor:array_backgroundColor,hoverBackgroundColor:array_hoverBackgroundColor}]},options:{tooltips:{enabled:!0},legend:{display:!1},legendCallback:function(e){return show_pie_legend(e,"AV")},pieceLabel:{mode:"percentage",precision:2,fontSize:chart_pie_font_size}}},ctx=$("#chart_AV").get(0).getContext("2d");chart_AV=new Chart(ctx,config),$("#AV_pie").html(chart_AV.generateLegend());var approval_label=[],approval_result=[];$(".approval_result_option").each(function(e){var t=$(this).html();approval_label.push(t),approval_result.push(+$(this).next().html())}),$(".approval_result").remove();var config={type:"bar",data:{labels:approval_label,datasets:[{data:approval_result,backgroundColor:array_backgroundColor,hoverBackgroundColor:array_hoverBackgroundColor}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0,userCallback:function(e,t,a){if(Math.floor(e)===e)return e},fontSize:chart_bar_font_size}}],xAxes:[{display:!1}]},tooltips:{enabled:!0},legend:{display:!1},legendCallback:function(e){return show_pie_legend(e,"approval")},responsive:!0}},ctx=$("#chart_approval").get(0).getContext("2d");chart_approval=new Chart(ctx,config),$("#approval_pie").html(chart_approval.generateLegend());var borda_label=[],borda_result=[];$(".borda_result_option").each(function(e){var t=$(this).html();borda_label.push(t),borda_result.push(+$(this).next().html())}),$(".borda_result").remove();var config={type:"pie",data:{labels:borda_label,datasets:[{data:borda_result,backgroundColor:array_backgroundColor,hoverBackgroundColor:array_hoverBackgroundColor}]},options:{tooltips:{enabled:!0},legend:{display:!1},legendCallback:function(e){return show_pie_legend(e,"borda")},pieceLabel:{mode:"percentage",precision:2,fontSize:chart_pie_font_size}}},ctx=$("#chart_borda").get(0).getContext("2d");chart_borda=new Chart(ctx,config),$("#borda_pie").html(chart_borda.generateLegend());var supplementary_label=[],supplementary_result=[];$(".supplementary_result_option").each(function(e){supplementary_label.push($(this).html()),supplementary_result.push(+$(this).next().html())}),$(".supplementary_result").remove();var config={type:"pie",data:{labels:supplementary_label,datasets:[{data:supplementary_result,backgroundColor:array_backgroundColor,hoverBackgroundColor:array_hoverBackgroundColor}]},options:{tooltips:{enabled:!0},legend:{display:!1},legendCallback:function(e){return show_pie_legend(e,"supplementary")},pieceLabel:{mode:"percentage",precision:2,fontSize:chart_pie_font_size}}},ctx=$("#chart_supplementary").get(0).getContext("2d");chart_supplementary=new Chart(ctx,config),$("#supplementary_pie").html(chart_supplementary.generateLegend())}$(".pop_up_just_voted").length&&setTimeout(function(){$(".pop_up_just_voted").fadeIn(),isScrolledIntoView($(".pop_up_just_voted"))?setTimeout(function(){$(".pop_up_just_voted").fadeOut()},1500):$(window).scroll(function(e){$(".pop_up_just_voted").length&&isScrolledIntoView($(".pop_up_just_voted"))&&setTimeout(function(){$(".pop_up_just_voted").fadeOut()},1500)})},150),$("a").click(function(e){e.stopPropagation()}),$(".public_list_more").click(function(e){var t="";$(this).hasClass("public_list_most_voted")?t="most_voted":$(this).hasClass("public_list_trending")?t="trending":$(this).hasClass("public_list_new")&&(t="new");var a=$(this).closest("ol").find("li").length,o=this;if(--a>350)return!1;$.ajax({type:"POST",cache:!1,url:"jx.php?action=get_more_list",data:"public_list="+t+"&list_size="+a,complete:function(e,t){var r=e.responseText.trim();0==r?$(o).closest("li").remove():($(o).closest("li").prev().after(r),($(o).closest("ol").find("li").length-1)%10!=0?$(o).closest("li").remove():a+10>=300&&$(o).closest("li").remove())}})});